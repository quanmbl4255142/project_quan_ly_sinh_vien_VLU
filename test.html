<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Web Development - Ch∆∞∆°ng 6: Th·ª±c h√†nh Email</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .practice-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .practice-section:hover {
            transform: translateY(-5px);
        }

        .section-header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .section-header:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }

        .section-header h2 {
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .section-content {
            padding: 30px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step {
            margin-bottom: 35px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #e74c3c;
            transition: all 0.3s ease;
            position: relative;
        }

        .step:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .step-number {
            position: absolute;
            top: -10px;
            left: 20px;
            background: #e74c3c;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .step h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
            margin-left: 20px;
        }

        .step p {
            margin-bottom: 15px;
            color: #555;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
            white-space: pre-wrap;
            word-wrap: break-word;
            tab-size: 4;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .code-block:hover {
            background: #34495e;
        }

        .code-block::before {
            content: "üìã Click to copy";
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.8em;
            color: #95a5a6;
        }

        .file-structure {
            background: #fff;
            border: 2px dashed #3498db;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: 600;
        }

        .output-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #f39c12;
        }

        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #17a2b8;
        }

        .checkpoint {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: center;
        }

        .checkpoint h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .config-table th,
        .config-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .config-table th {
            background-color: #e74c3c;
            color: white;
            font-weight: bold;
        }

        .config-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .section-header h2 {
                font-size: 1.4em;
            }
            
            .code-block {
                font-size: 12px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìß Flask Web Development</h1>
            <p>Ch∆∞∆°ng 6 - H∆∞·ªõng d·∫´n Th·ª±c h√†nh: Email Support v·ªõi Flask-Mail</p>
        </div>

        <!-- C√†i ƒë·∫∑t Flask-Mail -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('setup')">
                <h2>
                    1. C√†i ƒë·∫∑t v√† C·∫•u h√¨nh Flask-Mail
                    <span class="toggle-icon" id="icon-setup">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="setup">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>C√†i ƒë·∫∑t Flask-Mail Extension</h3>
                    <p>C√†i ƒë·∫∑t Flask-Mail th√¥ng qua pip trong virtual environment:</p>
                    
                    <div class="code-block">(venv) $ pip install flask-mail</div>

                    <div class="info-box">
                        <strong>Flask-Mail:</strong> Extension cung c·∫•p giao di·ªán ƒë∆°n gi·∫£n ƒë·ªÉ g·ª≠i email t·ª´ Flask applications, 
                        wraps smtplib c·ªßa Python v√† t√≠ch h·ª£p v·ªõi Flask.
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <h3>C·∫•u h√¨nh SMTP Server</h3>
                    <p>Flask-Mail c·∫ßn k·∫øt n·ªëi ƒë·∫øn SMTP server. B·∫£ng configuration keys:</p>
                    
                    <table class="config-table">
                        <tr>
                            <th>Key</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>MAIL_SERVER</td>
                            <td>localhost</td>
                            <td>Hostname ho·∫∑c IP address c·ªßa email server</td>
                        </tr>
                        <tr>
                            <td>MAIL_PORT</td>
                            <td>25</td>
                            <td>Port c·ªßa email server</td>
                        </tr>
                        <tr>
                            <td>MAIL_USE_TLS</td>
                            <td>False</td>
                            <td>Enable Transport Layer Security (TLS) security</td>
                        </tr>
                        <tr>
                            <td>MAIL_USE_SSL</td>
                            <td>False</td>
                            <td>Enable Secure Sockets Layer (SSL) security</td>
                        </tr>
                        <tr>
                            <td>MAIL_USERNAME</td>
                            <td>None</td>
                            <td>Mail account username</td>
                        </tr>
                        <tr>
                            <td>MAIL_PASSWORD</td>
                            <td>None</td>
                            <td>Mail account password</td>
                        </tr>
                    </table>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <h3>C·∫•u h√¨nh Gmail SMTP</h3>
                    <p>T·∫°o file <code>hello.py</code> v·ªõi c·∫•u h√¨nh Gmail:</p>
                    
                    <div class="code-block">import os
from flask import Flask
from flask_mail import Mail

app = Flask(__name__)

# Gmail SMTP Configuration
app.config['MAIL_SERVER'] = 'smtp.googlemail.com'
app.config['MAIL_PORT'] = 587
app.config['MAIL_USE_TLS'] = True
app.config['MAIL_USERNAME'] = os.environ.get('MAIL_USERNAME')
app.config['MAIL_PASSWORD'] = os.environ.get('MAIL_PASSWORD')

mail = Mail(app)</div>

                    <div class="warning-box">
                        <strong>B·∫£o m·∫≠t:</strong> Kh√¥ng hard-code username/password trong source code. 
                        S·ª≠ d·ª•ng environment variables ƒë·ªÉ b·∫£o v·ªá th√¥ng tin nh·∫°y c·∫£m.
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">4</div>
                    <h3>Thi·∫øt l·∫≠p Environment Variables</h3>
                    <p>C·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng cho Gmail credentials:</p>
                    
                    <h4>Linux/macOS:</h4>
                    <div class="code-block">(venv) $ export MAIL_USERNAME=<Gmail username>
(venv) $ export MAIL_PASSWORD=<Gmail password></div>

                    <h4>Windows:</h4>
                    <div class="code-block">(venv) $ set MAIL_USERNAME=<Gmail username>
(venv) $ set MAIL_PASSWORD=<Gmail password></div>

                    <div class="info-box">
                        <strong>Gmail App Password:</strong> N·∫øu b·∫≠t 2-factor authentication, 
                        b·∫°n c·∫ßn t·∫°o App Password thay v√¨ s·ª≠ d·ª•ng m·∫≠t kh·∫©u th√¥ng th∆∞·ªùng.
                    </div>
                </div>

                <div class="checkpoint">
                    <h4>üéØ Checkpoint 1</h4>
                    <p>Flask-Mail ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t v√† c·∫•u h√¨nh th√†nh c√¥ng!</p>
                </div>
            </div>
        </div>

        <!-- G·ª≠i Email t·ª´ Python Shell -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('python-shell')">
                <h2>
                    2. G·ª≠i Email t·ª´ Python Shell
                    <span class="toggle-icon" id="icon-python-shell">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="python-shell">
                <div class="step">
                    <div class="step-number">5</div>
                    <h3>Kh·ªüi t·∫°o Mail Instance</h3>
                    <p>C·∫≠p nh·∫≠t <code>hello.py</code> ƒë·ªÉ kh·ªüi t·∫°o Mail:</p>
                    
                    <div class="code-block">import os
from flask import Flask
from flask_mail import Mail, Message

app = Flask(__name__)

app.config['MAIL_SERVER'] = 'smtp.googlemail.com'
app.config['MAIL_PORT'] = 587
app.config['MAIL_USE_TLS'] = True
app.config['MAIL_USERNAME'] = os.environ.get('MAIL_USERNAME')
app.config['MAIL_PASSWORD'] = os.environ.get('MAIL_PASSWORD')

mail = Mail(app)

@app.route('/')
def index():
    return '<h1>Flask Email Demo</h1>'</div>
                </div>

                <div class="step">
                    <div class="step-number">6</div>
                    <h3>Test g·ª≠i Email qua Flask Shell</h3>
                    <p>S·ª≠ d·ª•ng Flask shell ƒë·ªÉ test g·ª≠i email:</p>
                    
                    <div class="code-block">(venv) $ flask shell
>>> from flask_mail import Message
>>> from hello import mail
>>> msg = Message('test email', sender='your-email@gmail.com', recipients=['target@example.com'])
>>> msg.body = 'This is a test email sent from Flask-Mail'
>>> msg.html = '<h1>This is a test email sent from Flask-Mail</h1>'
>>> with app.app_context():
...     mail.send(msg)
>>> exit()</div>

                    <div class="info-box">
                        <strong>Message Object:</strong>
                        <ul>
                            <li><strong>sender:</strong> Email address ng∆∞·ªùi g·ª≠i</li>
                            <li><strong>recipients:</strong> List email addresses ng∆∞·ªùi nh·∫≠n</li>
                            <li><strong>body:</strong> N·ªôi dung email d·∫°ng plain text</li>
                            <li><strong>html:</strong> N·ªôi dung email d·∫°ng HTML (optional)</li>
                        </ul>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">7</div>
                    <h3>Ki·ªÉm tra Email ƒë√£ g·ª≠i</h3>
                    <p>Ki·ªÉm tra inbox c·ªßa recipient ƒë·ªÉ x√°c nh·∫≠n email ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng:</p>
                    
                    <div class="output-box">
                        <strong>Expected Result:</strong> Email v·ªõi subject "test email" v√† n·ªôi dung HTML 
                        xu·∫•t hi·ªán trong inbox c·ªßa recipient.
                    </div>

                    <div class="warning-box">
                        <strong>Troubleshooting:</strong>
                        <ul>
                            <li>Ki·ªÉm tra spam folder n·∫øu kh√¥ng th·∫•y email</li>
                            <li>ƒê·∫£m b·∫£o Gmail credentials ch√≠nh x√°c</li>
                            <li>Ki·ªÉm tra "Less secure app access" trong Gmail settings</li>
                        </ul>
                    </div>
                </div>

                <div class="checkpoint">
                    <h4>üéØ Checkpoint 2</h4>
                    <p>Th√†nh c√¥ng g·ª≠i email t·ª´ Flask shell!</p>
                </div>
            </div>
        </div>

        <!-- T√≠ch h·ª£p Email v·ªõi Application -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('integration')">
                <h2>
                    3. T√≠ch h·ª£p Email v·ªõi Web Application
                    <span class="toggle-icon" id="icon-integration">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="integration">
                <div class="step">
                    <div class="step-number">8</div>
                    <h3>T·∫°o Email Support Function</h3>
                    <p>T·∫°o helper function ƒë·ªÉ g·ª≠i email trong <code>hello.py</code>:</p>
                    
                    <div class="code-block">from flask import Flask, render_template
from flask_mail import Mail, Message

def send_email(to, subject, template, **kwargs):
    msg = Message(
        app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
        sender=app.config['FLASKY_MAIL_SENDER'], 
        recipients=[to]
    )
    msg.body = render_template(template + '.txt', **kwargs)
    msg.html = render_template(template + '.html', **kwargs)
    mail.send(msg)</div>
                </div>

                <div class="step">
                    <div class="step-number">9</div>
                    <h3>Th√™m Email Configuration</h3>
                    <p>C·∫≠p nh·∫≠t configuration ƒë·ªÉ h·ªó tr·ª£ email templates:</p>
                    
                    <div class="code-block">import os
from flask import Flask, render_template, request
from flask_mail import Mail, Message

app = Flask(__name__)

# Email configuration
app.config['MAIL_SERVER'] = 'smtp.googlemail.com'
app.config['MAIL_PORT'] = 587
app.config['MAIL_USE_TLS'] = True
app.config['MAIL_USERNAME'] = os.environ.get('MAIL_USERNAME')
app.config['MAIL_PASSWORD'] = os.environ.get('MAIL_PASSWORD')

# Application-specific email settings
app.config['FLASKY_MAIL_SUBJECT_PREFIX'] = '[Flasky]'
app.config['FLASKY_MAIL_SENDER'] = 'Flasky Admin <flask-app@example.com>'

mail = Mail(app)</div>
                </div>

                <div class="step">
                    <div class="step-number">10</div>
                    <h3>T·∫°o Email Templates</h3>
                    <p>T·∫°o th∆∞ m·ª•c <code>templates/mail/</code> v√† email templates:</p>
                    
                    <div class="file-structure">templates/
‚îú‚îÄ‚îÄ mail/
‚îÇ   ‚îú‚îÄ‚îÄ new_user.txt
‚îÇ   ‚îî‚îÄ‚îÄ new_user.html
‚îî‚îÄ‚îÄ base.html</div>

                    <p><strong>File templates/mail/new_user.txt:</strong></p>
                    <div class="code-block">User {{ user.username }} has joined.

Welcome to Flasky!

Best regards,
The Flasky Team</div>

                    <p><strong>File templates/mail/new_user.html:</strong></p>
                    <div class="code-block">&lt;p&gt;User &lt;b&gt;{{ user.username }}&lt;/b&gt; has joined.&lt;/p&gt;
&lt;p&gt;&lt;b&gt;Welcome to Flasky!&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;
    Best regards,&lt;br&gt;
    &lt;em&gt;The Flasky Team&lt;/em&gt;
&lt;/p&gt;</div>
                </div>

                <div class="step">
                    <div class="step-number">11</div>
                    <h3>T√≠ch h·ª£p Email v·ªõi Form</h3>
                    <p>T·∫°o route g·ª≠i email khi c√≥ user m·ªõi ƒëƒÉng k√Ω:</p>
                    
                    <div class="code-block">from flask import Flask, render_template, request, redirect, url_for

class User:
    def __init__(self, username):
        self.username = username

@app.route('/', methods=['GET', 'POST'])
def index():
    user = None
    if request.method == 'POST':
        username = request.form.get('username')
        if username:
            user = User(username)
            # Send welcome email
            if app.config['MAIL_USERNAME']:
                send_email(app.config['MAIL_USERNAME'], 
                          'New User', 'mail/new_user', user=user)
    
    return render_template('index.html', user=user)</div>
                </div>

                <div class="step">
                    <div class="step-number">12</div>
                    <h3>T·∫°o Form Template</h3>
                    <p>C·∫≠p nh·∫≠t <code>templates/index.html</code>:</p>
                    
                    <div class="code-block">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Flask Email Demo&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;Flask Email Demo&lt;/h1&gt;
        
        &lt;form method="POST"&gt;
            &lt;div class="form-group"&gt;
                &lt;label&gt;Your Name:&lt;/label&gt;
                &lt;input type="text" name="username" required&gt;
            &lt;/div&gt;
            &lt;button type="submit"&gt;Join &amp; Send Welcome Email&lt;/button&gt;
        &lt;/form&gt;
        
        {% if user %}
            &lt;h2&gt;Welcome {{ user.username }}!&lt;/h2&gt;
            &lt;p&gt;A welcome email has been sent to the admin.&lt;/p&gt;
        {% endif %}
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</div>
                </div>

                <div class="checkpoint">
                    <h4>üéØ Checkpoint 3</h4>
                    <p>Email ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p v·ªõi web application th√†nh c√¥ng!</p>
                </div>
            </div>
        </div>

        <!-- Asynchronous Email -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('async-email')">
                <h2>
                    4. Sending Asynchronous Email
                    <span class="toggle-icon" id="icon-async-email">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="async-email">
                <div class="step">
                    <div class="step-number">13</div>
                    <h3>V·∫•n ƒë·ªÅ v·ªõi Synchronous Email</h3>
                    <p>G·ª≠i email synchronous c√≥ th·ªÉ g√¢y ch·∫≠m response time c·ªßa web application.</p>
                    
                    <div class="warning-box">
                        <strong>V·∫•n ƒë·ªÅ:</strong>
                        <ul>
                            <li>Web browser b·ªã "ƒë√≥ng bƒÉng" khi g·ª≠i email</li>
                            <li>User ph·∫£i ƒë·ª£i email g·ª≠i xong m·ªõi th·∫•y response</li>
                            <li>SMTP connection c√≥ th·ªÉ timeout</li>
                        </ul>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">14</div>
                    <h3>T·∫°o Asynchronous Email Function</h3>
                    <p>S·ª≠ d·ª•ng Python threading ƒë·ªÉ g·ª≠i email b·∫•t ƒë·ªìng b·ªô:</p>
                    
                    <div class="code-block">from threading import Thread

def send_async_email(app, msg):
    with app.app_context():
        mail.send(msg)

def send_email(to, subject, template, **kwargs):
    msg = Message(
        app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
        sender=app.config['FLASKY_MAIL_SENDER'], 
        recipients=[to]
    )
    msg.body = render_template(template + '.txt', **kwargs)
    msg.html = render_template(template + '.html', **kwargs)
    
    thr = Thread(target=send_async_email, args=[app, msg])
    thr.start()
    return thr</div>

                    <div class="info-box">
                        <strong>Threading:</strong> T·∫°o separate thread ƒë·ªÉ g·ª≠i email, main thread ti·∫øp t·ª•c x·ª≠ l√Ω request
                        v√† tr·∫£ response v·ªÅ browser ngay l·∫≠p t·ª©c.
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">15</div>
                    <h3>Test Asynchronous Email</h3>
                    <p>File ho√†n ch·ªânh <code>hello.py</code> v·ªõi asynchronous email:</p>
                    
                    <div class="code-block">import os
from threading import Thread
from flask import Flask, render_template, request
from flask_mail import Mail, Message

app = Flask(__name__)

# Email configuration  
app.config['MAIL_SERVER'] = 'smtp.googlemail.com'
app.config['MAIL_PORT'] = 587
app.config['MAIL_USE_TLS'] = True
app.config['MAIL_USERNAME'] = os.environ.get('MAIL_USERNAME')
app.config['MAIL_PASSWORD'] = os.environ.get('MAIL_PASSWORD')
app.config['FLASKY_MAIL_SUBJECT_PREFIX'] = '[Flasky]'
app.config['FLASKY_MAIL_SENDER'] = 'Flasky Admin <your-email@gmail.com>'

mail = Mail(app)

def send_async_email(app, msg):
    with app.app_context():
        mail.send(msg)

def send_email(to, subject, template, **kwargs):
    msg = Message(
        app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
        sender=app.config['FLASKY_MAIL_SENDER'],
        recipients=[to]
    )
    msg.body = render_template(template + '.txt', **kwargs)
    msg.html = render_template(template + '.html', **kwargs)
    
    thr = Thread(target=send_async_email, args=[app, msg])
    thr.start()
    return thr

class User:
    def __init__(self, username):
        self.username = username

@app.route('/', methods=['GET', 'POST'])
def index():
    user = None
    if request.method == 'POST':
        username = request.form.get('username')
        if username:
            user = User(username)
            if app.config['MAIL_USERNAME']:
                send_email(app.config['MAIL_USERNAME'], 
                          'New User', 'mail/new_user', user=user)
    
    return render_template('index.html', user=user)</div>
                </div>

                <div class="step">
                    <div class="step-number">16</div>
                    <h3>Test Application</h3>
                    <p>Kh·ªüi ƒë·ªông application v√† test asynchronous email:</p>
                    
                    <div class="code-block">(venv) $ flask run</div>

                    <div class="output-box">
                        <strong>Ki·ªÉm tra:</strong>
                        <ol>
                            <li>Truy c·∫≠p http://localhost:5000</li>
                            <li>Nh·∫≠p username v√† submit form</li>
                            <li>Page response ngay l·∫≠p t·ª©c (kh√¥ng ƒë·ª£i email)</li>
                            <li>Email ƒë∆∞·ª£c g·ª≠i ·ªü background</li>
                        </ol>
                    </div>
                </div>

                <div class="checkpoint">
                    <h4>üéØ Checkpoint 4</h4>
                    <p>Asynchronous email ƒë√£ ho·∫°t ƒë·ªông! User experience ƒë∆∞·ª£c c·∫£i thi·ªán ƒë√°ng k·ªÉ.</p>
                </div>
            </div>
        </div>

        <!-- Advanced Email Features -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('advanced')">
                <h2>
                    5. Advanced Email Features & Best Practices
                    <span class="toggle-icon" id="icon-advanced">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="advanced">
                <div class="step">
                    <div class="step-number">17</div>
                    <h3>Email v·ªõi Attachments</h3>
                    <p>Th√™m t√≠nh nƒÉng g·ª≠i file ƒë√≠nh k√®m:</p>
                    
                    <div class="code-block">from flask_mail import Attachment

def send_email_with_attachment(to, subject, template, attachment_path=None, **kwargs):
    msg = Message(
        app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
        sender=app.config['FLASKY_MAIL_SENDER'],
        recipients=[to]
    )
    msg.body = render_template(template + '.txt', **kwargs)
    msg.html = render_template(template + '.html', **kwargs)
    
    # Add attachment if provided
    if attachment_path:
        with app.open_resource(attachment_path) as fp:
            msg.attach(
                filename=attachment_path.split('/')[-1],
                content_type='application/pdf',
                data=fp.read()
            )
    
    thr = Thread(target=send_async_email, args=[app, msg])
    thr.start()
    return thr</div>
                </div>

                <div class="step">
                    <div class="step-number">18</div>
                    <h3>Bulk Email v·ªõi Multiple Recipients</h3>
                    <p>G·ª≠i email ƒë·∫øn nhi·ªÅu ng∆∞·ªùi nh·∫≠n:</p>
                    
                    <div class="code-block">def send_bulk_email(recipients, subject, template, **kwargs):
    """Send email to multiple recipients efficiently"""
    
    with mail.connect() as conn:
        for recipient in recipients:
            msg = Message(
                app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
                sender=app.config['FLASKY_MAIL_SENDER'],
                recipients=[recipient]
            )
            msg.body = render_template(template + '.txt', **kwargs)
            msg.html = render_template(template + '.html', **kwargs)
            conn.send(msg)</div>

                    <div class="info-box">
                        <strong>mail.connect():</strong> T·∫°o persistent connection ƒë·ªÉ g·ª≠i multiple emails hi·ªáu qu·∫£ h∆°n
                        thay v√¨ t·∫°o connection m·ªõi cho m·ªói email.
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">19</div>
                    <h3>Error Handling cho Email</h3>
                    <p>Th√™m proper error handling:</p>
                    
                    <div class="code-block">import logging
from smtplib import SMTPException

def send_email_safe(to, subject, template, **kwargs):
    """Send email with error handling"""
    try:
        msg = Message(
            app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
            sender=app.config['FLASKY_MAIL_SENDER'],
            recipients=[to]
        )
        msg.body = render_template(template + '.txt', **kwargs)
        msg.html = render_template(template + '.html', **kwargs)
        
        with app.app_context():
            mail.send(msg)
        
        app.logger.info(f'Email sent successfully to {to}')
        return True
        
    except SMTPException as e:
        app.logger.error(f'SMTP error sending email to {to}: {str(e)}')
        return False
    except Exception as e:
        app.logger.error(f'Unexpected error sending email to {to}: {str(e)}')
        return False</div>
                </div>

                <div class="step">
                    <div class="step-number">20</div>
                    <h3>Environment-specific Configuration</h3>
                    <p>C·∫•u h√¨nh email kh√°c nhau cho development/production:</p>
                    
                    <div class="code-block">import os

class Config:
    MAIL_SERVER = os.environ.get('MAIL_SERVER', 'smtp.googlemail.com')
    MAIL_PORT = int(os.environ.get('MAIL_PORT', '587'))
    MAIL_USE_TLS = os.environ.get('MAIL_USE_TLS', 'true').lower() in ['true', 'on', '1']
    MAIL_USERNAME = os.environ.get('MAIL_USERNAME')
    MAIL_PASSWORD = os.environ.get('MAIL_PASSWORD')
    FLASKY_MAIL_SUBJECT_PREFIX = '[Flasky]'
    FLASKY_MAIL_SENDER = 'Flasky Admin <flasky@example.com>'
    FLASKY_ADMIN = os.environ.get('FLASKY_ADMIN')

class DevelopmentConfig(Config):
    DEBUG = True
    # Log emails to console instead of sending in development
    MAIL_SUPPRESS_SEND = os.environ.get('MAIL_SUPPRESS_SEND', 'false').lower() in ['true', 'on', '1']

class ProductionConfig(Config):
    DEBUG = False
    # Always send emails in production
    MAIL_SUPPRESS_SEND = False

config = {
    'development': DevelopmentConfig,
    'production': ProductionConfig,
    'default': DevelopmentConfig
}</div>
                </div>

                <div class="step">
                    <div class="step-number">21</div>
                    <h3>Email Templates v·ªõi Rich Content</h3>
                    <p>T·∫°o email template v·ªõi CSS styling:</p>
                    
                    <p><strong>File templates/mail/welcome.html:</strong></p>
                    <div class="code-block">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;style&gt;
        .email-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .header {
            background-color: #3498db;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
        }
        .content {
            background-color: #f8f9fa;
            padding: 30px;
            border-radius: 0 0 8px 8px;
        }
        .button {
            display: inline-block;
            background-color: #e74c3c;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 5px;
            margin: 20px 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="email-container"&gt;
        &lt;div class="header"&gt;
            &lt;h1&gt;Welcome to Flasky!&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div class="content"&gt;
            &lt;h2&gt;Hello {{ user.username }}!&lt;/h2&gt;
            &lt;p&gt;Thank you for joining our community. We're excited to have you on board!&lt;/p&gt;
            
            &lt;p&gt;Here are some things you can do:&lt;/p&gt;
            &lt;ul&gt;
                &lt;li&gt;Complete your profile&lt;/li&gt;
                &lt;li&gt;Explore our features&lt;/li&gt;
                &lt;li&gt;Connect with other users&lt;/li&gt;
            &lt;/ul&gt;
            
            &lt;a href="{{ url_for('index', _external=True) }}" class="button"&gt;
                Visit Flasky
            &lt;/a&gt;
            
            &lt;p&gt;
                Best regards,&lt;br&gt;
                &lt;strong&gt;The Flasky Team&lt;/strong&gt;
            &lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</div>
                </div>

                <div class="checkpoint">
                    <h4>üéØ Checkpoint 5</h4>
                    <p>Advanced email features ƒë√£ ƒë∆∞·ª£c implement th√†nh c√¥ng!</p>
                </div>
            </div>
        </div>

        <!-- Testing & Debugging -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('testing')">
                <h2>
                    6. Testing v√† Debugging Email
                    <span class="toggle-icon" id="icon-testing">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="testing">
                <div class="step">
                    <div class="step-number">22</div>
                    <h3>S·ª≠ d·ª•ng MAIL_SUPPRESS_SEND</h3>
                    <p>Trong development, suppress email sending ƒë·ªÉ tr√°nh g·ª≠i email th·∫≠t:</p>
                    
                    <div class="code-block"># Set environment variable
(venv) $ export MAIL_SUPPRESS_SEND=1

# Or in code
app.config['MAIL_SUPPRESS_SEND'] = True</div>

                    <div class="info-box">
                        <strong>MAIL_SUPPRESS_SEND:</strong> Khi ƒë∆∞·ª£c set True, Flask-Mail s·∫Ω kh√¥ng g·ª≠i email th·∫≠t
                        nh∆∞ng v·∫´n th·ª±c hi·ªán validation v√† log operations.
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">23</div>
                    <h3>Fake Email Backend cho Testing</h3>
                    <p>T·∫°o fake email backend ƒë·ªÉ test m√† kh√¥ng g·ª≠i email th·∫≠t:</p>
                    
                    <div class="code-block">class FakeMailBackend:
                    """Fake mail backend for testing"""
                    
                    def __init__(self):
                        self.outbox = []
    
                    def send(self, message):
                        """Fake send - just store message in outbox"""
                        self.outbox.append(message)
                        print(f"FAKE EMAIL SENT:")
                        print(f"To: {message.recipients}")
                        print(f"Subject: {message.subject}")
                        print(f"Body: {message.body}")
                        print("-" * 50)

# Use fake backend in development
if app.config.get('TESTING') or app.config.get('DEBUG'):
    fake_mail = FakeMailBackend()
    
    def send_email_debug(to, subject, template, **kwargs):
        msg = Message(subject, recipients=[to])
        msg.body = render_template(template + '.txt', **kwargs)
        fake_mail.send(msg)</div>
                </div>

                <div class="step">
                    <div class="step-number">24</div>
                    <h3>Email Unit Testing</h3>
                    <p>T·∫°o unit test cho email functionality:</p>
                    
                    <div class="code-block">import unittest
from flask import current_app
from app import create_app, mail

class EmailTestCase(unittest.TestCase):
    
    def setUp(self):
        self.app = create_app('testing')
        self.app_context = self.app.app_context()
        self.app_context.push()
        
    def tearDown(self):
        self.app_context.pop()
        
    def test_email_configuration(self):
        """Test email is properly configured"""
        self.assertTrue(current_app.config['MAIL_SERVER'])
        self.assertTrue(current_app.config['MAIL_USE_TLS'])
        
    def test_send_email(self):
        """Test email sending functionality"""
        with mail.record_messages() as outbox:
            send_email('test@example.com', 'Test Subject', 'mail/test')
            self.assertEqual(len(outbox), 1)
            self.assertEqual(outbox[0].subject, '[Flasky] Test Subject')
            self.assertIn('test@example.com', outbox[0].recipients)

if __name__ == '__main__':
    unittest.main()</div>
                </div>

                <div class="step">
                    <div class="step-number">25</div>
                    <h3>Debug Email trong Development</h3>
                    <p>Th√™m debug logging ƒë·ªÉ track email operations:</p>
                    
                    <div class="code-block">import logging
from flask.logging import default_handler

# Configure logging
if app.debug:
    app.logger.setLevel(logging.DEBUG)
    
    # Add custom handler for email debugging
    email_handler = logging.StreamHandler()
    email_handler.setLevel(logging.INFO)
    formatter = logging.Formatter(
        '%(asctime)s %(levelname)s: %(message)s'
    )
    email_handler.setFormatter(formatter)
    app.logger.addHandler(email_handler)

def send_email_with_logging(to, subject, template, **kwargs):
    """Send email with detailed logging"""
    app.logger.info(f'Preparing to send email to: {to}')
    app.logger.info(f'Subject: {subject}')
    
    try:
        msg = Message(
            app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
            sender=app.config['FLASKY_MAIL_SENDER'],
            recipients=[to]
        )
        msg.body = render_template(template + '.txt', **kwargs)
        msg.html = render_template(template + '.html', **kwargs)
        
        app.logger.info('Email message created successfully')
        
        if not app.config.get('MAIL_SUPPRESS_SEND'):
            mail.send(msg)
            app.logger.info('Email sent successfully')
        else:
            app.logger.info('Email suppressed (MAIL_SUPPRESS_SEND=True)')
            
    except Exception as e:
        app.logger.error(f'Failed to send email: {str(e)}')</div>
                </div>

                <div class="checkpoint">
                    <h4>üéØ Checkpoint 6</h4>
                    <p>Email testing v√† debugging tools ƒë√£ ƒë∆∞·ª£c setup ho√†n ch·ªânh!</p>
                </div>
            </div>
        </div>

        <!-- T·ªïng k·∫øt v√† Best Practices -->
        <div class="practice-section">
            <div class="section-header" onclick="toggleSection('summary')">
                <h2>
                    7. T·ªïng k·∫øt v√† Best Practices
                    <span class="toggle-icon" id="icon-summary">‚ñº</span>
                </h2>
            </div>
            <div class="section-content" id="summary">
                <div class="step">
                    <div class="step-number">‚úì</div>
                    <h3>Nh·ªØng g√¨ ƒë√£ ho√†n th√†nh</h3>
                    
                    <div class="info-box">
                        <strong>K·ªπ nƒÉng ƒë√£ th√†nh th·∫°o:</strong>
                        <ul>
                            <li>‚úÖ C√†i ƒë·∫∑t v√† c·∫•u h√¨nh Flask-Mail extension</li>
                            <li>‚úÖ Thi·∫øt l·∫≠p SMTP server (Gmail) configuration</li>
                            <li>‚úÖ G·ª≠i email t·ª´ Flask shell v√† web application</li>
                            <li>‚úÖ T·∫°o email templates v·ªõi HTML v√† plain text</li>
                            <li>‚úÖ Implement asynchronous email sending</li>
                            <li>‚úÖ Advanced features: attachments, bulk email</li>
                            <li>‚úÖ Error handling v√† logging</li>
                            <li>‚úÖ Testing strategies cho email functionality</li>
                        </ul>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">üìÇ</div>
                    <h3>C·∫•u tr√∫c Project cu·ªëi c√πng</h3>
                    
                    <div class="file-structure">flasky/
‚îú‚îÄ‚îÄ venv/                    # Virtual environment
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ mail/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ new_user.txt     # Plain text email template
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ new_user.html    # HTML email template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ welcome.html     # Rich HTML template
‚îÇ   ‚îú‚îÄ‚îÄ base.html
‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ hello.py                 # Main Flask application
‚îú‚îÄ‚îÄ config.py                # Configuration classes
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ test_email.py        # Email unit tests
‚îî‚îÄ‚îÄ README.md</div>
                </div>

                <div class="step">
                    <div class="step-number">üìã</div>
                    <h3>Email Best Practices</h3>
                    
                    <div class="warning-box">
                        <strong>Security & Performance:</strong>
                        <ul>
                            <li><strong>Environment Variables:</strong> Lu√¥n s·ª≠ d·ª•ng env vars cho credentials</li>
                            <li><strong>Asynchronous Sending:</strong> S·ª≠ d·ª•ng threads cho better UX</li>
                            <li><strong>Error Handling:</strong> Catch SMTP exceptions v√† log properly</li>
                            <li><strong>Rate Limiting:</strong> Implement rate limiting cho bulk emails</li>
                            <li><strong>Templates:</strong> T√°ch email content kh·ªèi application logic</li>
                        </ul>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">üîß</div>
                    <h3>Production Checklist</h3>
                    
                    <div class="info-box">
                        <strong>Tr∆∞·ªõc khi deploy:</strong>
                        <ul>
                            <li>‚úÖ Set MAIL_SUPPRESS_SEND=False trong production</li>
                            <li>‚úÖ Configure proper SMTP server (kh√¥ng d√πng Gmail)</li>
                            <li>‚úÖ Setup email monitoring v√† alerting</li>
                            <li>‚úÖ Implement email queue system (Redis/Celery)</li>
                            <li>‚úÖ Add email delivery status tracking</li>
                            <li>‚úÖ Setup SPF, DKIM records cho domain</li>
                        </ul>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">üìà</div>
                    <h3>Code ho√†n ch·ªânh - hello.py</h3>
                    
                    <div class="code-block">import os
from threading import Thread
from flask import Flask, render_template, request
from flask_mail import Mail, Message

app = Flask(__name__)

# Email Configuration
app.config['MAIL_SERVER'] = os.environ.get('MAIL_SERVER', 'smtp.googlemail.com')
app.config['MAIL_PORT'] = int(os.environ.get('MAIL_PORT', '587'))
app.config['MAIL_USE_TLS'] = os.environ.get('MAIL_USE_TLS', 'true').lower() in ['true', 'on', '1']
app.config['MAIL_USERNAME'] = os.environ.get('MAIL_USERNAME')
app.config['MAIL_PASSWORD'] = os.environ.get('MAIL_PASSWORD')
app.config['FLASKY_MAIL_SUBJECT_PREFIX'] = '[Flasky]'
app.config['FLASKY_MAIL_SENDER'] = 'Flasky Admin <your-email@gmail.com>'
app.config['MAIL_SUPPRESS_SEND'] = os.environ.get('MAIL_SUPPRESS_SEND', 'false').lower() in ['true', 'on', '1']

mail = Mail(app)

def send_async_email(app, msg):
    """Send email asynchronously"""
    with app.app_context():
        try:
            mail.send(msg)
            app.logger.info(f'Email sent successfully')
        except Exception as e:
            app.logger.error(f'Failed to send email: {str(e)}')

def send_email(to, subject, template, **kwargs):
    """Send email with templates"""
    msg = Message(
        app.config['FLASKY_MAIL_SUBJECT_PREFIX'] + ' ' + subject,
        sender=app.config['FLASKY_MAIL_SENDER'],
        recipients=[to]
    )
    msg.body = render_template(template + '.txt', **kwargs)
    msg.html = render_template(template + '.html', **kwargs)
    
    thr = Thread(target=send_async_email, args=[app, msg])
    thr.start()
    return thr

class User:
    def __init__(self, username):
        self.username = username

@app.route('/', methods=['GET', 'POST'])
def index():
    user = None
    if request.method == 'POST':
        username = request.form.get('username')
        if username:
            user = User(username)
            if app.config['MAIL_USERNAME']:
                send_email(app.config['MAIL_USERNAME'], 
                          'New User Registered', 
                          'mail/new_user', 
                          user=user)
    
    return render_template('index.html', user=user)

if __name__ == '__main__':
    app.run(debug=True)</div>
                </div>

                <div class="step">
                    <div class="step-number">üöÄ</div>
                    <h3>Chu·∫©n b·ªã cho Ch∆∞∆°ng ti·∫øp theo</h3>
                    <p>Ch∆∞∆°ng 7 s·∫Ω h·ªçc v·ªÅ <span class="highlight">Large Application Structure</span>:</p>
                    
                    <div class="info-box">
                        <strong>S·∫Ω h·ªçc:</strong>
                        <ul>
                            <li>Application factories v√† blueprints</li>
                            <li>Configuration management</li>
                            <li>Application structure best practices</li>
                            <li>Unit testing organization</li>
                            <li>Database migrations management</li>
                        </ul>
                    </div>

                    <div class="checkpoint">
                        <h4>üéì Ho√†n th√†nh Ch∆∞∆°ng 6!</h4>
                        <p>Ch√∫c m·ª´ng! B·∫°n ƒë√£ th√†nh th·∫°o email functionality trong Flask v√† s·∫µn s√†ng x√¢y d·ª±ng larger applications.</p>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">üí°</div>
                    <h3>B√†i t·∫≠p th·ª±c h√†nh th√™m</h3>
                    
                    <div class="info-box">
                        <strong>Th·ª≠ th√°ch b·∫£n th√¢n:</strong>
                        <ol>
                            <li>T·∫°o email confirmation system cho user registration</li>
                            <li>Implement password reset qua email</li>
                            <li>T·∫°o newsletter subscription v·ªõi unsubscribe link</li>
                            <li>Setup email notifications cho blog comments</li>
                            <li>T·∫°o admin panel ƒë·ªÉ manage email templates</li>
                        </ol>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">üîß</div>
                    <h3>Troubleshooting Email Issues</h3>
                    
                    <div class="warning-box">
                        <strong>Common Issues & Solutions:</strong>
                        <ul>
                            <li><strong>SMTPAuthenticationError:</strong> Check Gmail credentials v√† App Password</li>
                            <li><strong>SMTPConnectError:</strong> Verify SMTP server v√† port settings</li>
                            <li><strong>Email not received:</strong> Check spam folder, sender reputation</li>
                            <li><strong>SSL/TLS errors:</strong> Verify MAIL_USE_TLS/MAIL_USE_SSL settings</li>
                            <li><strong>Template not found:</strong> Check template path v√† file extensions</li>
                        </ul>
                    </div>

                    <div class="code-block"># Debug commands
# Check Flask-Mail installation
(venv) $ pip show flask-mail

# Test SMTP connection
(venv) $ python -c "import smtplib; s=smtplib.SMTP('smtp.gmail.com', 587); s.starttls(); print('SMTP OK')"

# Check email templates
(venv) $ find templates -name "*.txt" -o -name "*.html"

# Test email sending
(venv) $ flask shell
>>> from hello import send_email
>>> send_email('test@example.com', 'Test', 'mail/test')</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const icon = document.getElementById('icon-' + sectionId);
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.textContent = '‚ñº';
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('active');
                icon.textContent = '‚ñ≤';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // Auto-open first section
        document.addEventListener('DOMContentLoaded', function() {
            toggleSection('setup');
            
            // Add click to copy functionality for code blocks
            document.querySelectorAll('.code-block').forEach(block => {
                block.addEventListener('click', function() {
                    const text = this.textContent.replace('üìã Click to copy', '').trim();
                    navigator.clipboard.writeText(text).then(() => {
                        const originalBg = this.style.backgroundColor;
                        this.style.backgroundColor = '#27ae60';
                        setTimeout(() => {
                            this.style.backgroundColor = originalBg;
                        }, 300);
                    }).catch(() => {
                        // Fallback for browsers without clipboard API
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        const originalBg = this.style.backgroundColor;
                        this.style.backgroundColor = '#27ae60';
                        setTimeout(() => {
                            this.style.backgroundColor = originalBg;
                        }, 300);
                    });
                });
            });

            // Animate steps on scroll
            const steps = document.querySelectorAll('.step');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            steps.forEach(step => {
                step.style.opacity = '0';
                step.style.transform = 'translateY(20px)';
                step.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(step);
            });
        });

        // Progress tracking
        let completedSteps = 0;
        const totalSteps = 25;

        document.querySelectorAll('.step').forEach((step, index) => {
            step.addEventListener('click', function() {
                const stepNumber = this.querySelector('.step-number');
                if (!this.classList.contains('completed')) {
                    this.classList.add('completed');
                    if (stepNumber) stepNumber.style.backgroundColor = '#27ae60';
                    completedSteps++;
                } else {
                    this.classList.remove('completed');
                    if (stepNumber) stepNumber.style.backgroundColor = '#e74c3c';
                    completedSteps--;
                }
                updateProgress();
            });
        });

        function updateProgress() {
            const progressPercent = (completedSteps / totalSteps) * 100;
            console.log(`Email Chapter Progress: ${progressPercent.toFixed(1)}%`);
        }
    </script>
</body>
</html>
                